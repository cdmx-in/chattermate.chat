(()=>{var M=(g,f,e)=>new Promise((c,b)=>{var u=l=>{try{s(e.next(l))}catch(d){b(d)}},I=l=>{try{s(e.throw(l))}catch(d){b(d)}},s=l=>l.done?c(l.value):Promise.resolve(l.value).then(u,I);s((e=e.apply(g,f)).next())});window.chattermateId;window.ChatterMate;(function(){function g(t){return/^#[0-9A-F]{6}$/i.test(t)}function f(){return"https://api.chattermate.chat/api/v1"}let e={baseUrl:f(),containerId:"chattermate-container",buttonId:"chattermate-button",chatBubbleColor:"#f34611",loadingContainerId:"chattermate-loading",tokenKey:"ctid",containerBottom:100,containerRight:20,containerWidth:400,chatInitiationMessages:[],initiationMessageId:"chattermate-initiation",initiationShownKey:"ctim_shown"};function c(){let t=document.createElement("style");t.id="chattermate-styles",t.textContent=`
      #${e.buttonId} {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 30px;
        background: ${e.chatBubbleColor};
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 999999;
        transition: transform 0.3s ease;
      }

      #${e.buttonId}:hover {
        transform: scale(1.1);
      }

      #${e.buttonId}.loading {
        position: relative;
      }

      #${e.buttonId}.loading:after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        top: 50%;
        left: 50%;
        margin: -8px 0 0 -8px;
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: chattermate-spin 0.6s linear infinite;
      }

      #${e.buttonId}.active .chat-icon {
        display: none;
      }

      #${e.buttonId}.active .close-icon {
        display: block !important;
      }

      @keyframes chattermate-spin {
        to {transform: rotate(360deg);}
      }

      /* Subtle idle bounce for the chat button when closed */
      @keyframes chattermate-bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-3px); }
      }

      #${e.containerId} {
        position: fixed;
        bottom: ${e.containerBottom||100}px;
        right: ${e.containerRight||20}px;
        width: ${e.containerWidth||400}px;
        height: 600px;
        background: transparent;
        z-index: 999999;
        overflow: hidden;
        /* Animated open/close with slide + fade */
        opacity: 0;
        visibility: hidden;
        transform: translateY(16px) scale(0.98);
        transition: opacity 360ms cubic-bezier(0.22, 1, 0.36, 1), transform 360ms cubic-bezier(0.22, 1, 0.36, 1), visibility 0s linear 360ms;
        border: none;
        padding: 0;
        margin: 0;
        pointer-events: none;
      }

      #${e.containerId}.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
        transition: opacity 420ms cubic-bezier(0.22, 1, 0.36, 1), transform 420ms cubic-bezier(0.22, 1, 0.36, 1);
        pointer-events: auto;
      }

      /* Clean border around the widget container */
      #${e.containerId}::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 24px;
        pointer-events: none;
        border: 1px solid #e5e7eb;
      }

        .chattermate-iframe {
                width: 100%;
        height: 100%;
        border: none;
        padding: 0;
        margin: 0;
        display: block;
        border-radius: 24px;
        /* Rely on corner shadows from container */
        box-shadow: none;
      }

      #chattermate-mobile-close {
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        width: 44px;
        height: 44px;
        background: transparent;
        border: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1000000;
        transition: all 0.3s ease;
      }

      #chattermate-mobile-topbar {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        z-index: 999999;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
      }

      #chattermate-mobile-topbar.active {
        display: flex;
      }

      #chattermate-mobile-topbar .topbar-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin: 0;
      }

      #chattermate-mobile-close.active {
        display: flex;
      }

      @media (max-width: 768px) {
        #${e.containerId} {
          width: 100vw !important;
          height: 100vh !important;
          height: 100dvh !important; /* Dynamic viewport height for mobile browsers */
          top: 0 !important;
          left: 0 !important;
          bottom: 0 !important;
          right: 0 !important;
          border-radius: 0 !important;
          position: fixed !important;
          margin: 0 !important;
          padding: 0 !important;
        }

        #${e.containerId}.active {
          bottom: 0 !important;
        }

        .chattermate-iframe {
          border-radius: 0 !important;
          width: 100vw !important;
          height: 100vh !important;
          height: 100dvh !important; /* Dynamic viewport height for mobile browsers */
          position: absolute !important;
          top: 0 !important;
          left: 0 !important;
          margin: 0 !important;
          padding: 0 !important;
        }

        #${e.buttonId} {
          display: none;
        }

        #${e.buttonId}.mobile-closed {
          display: block !important;
        }

        #chattermate-mobile-close.active {
          display: flex !important;
        }

        #chattermate-mobile-close:hover {
          opacity: 0.7;
        }

        /* ASK_ANYTHING style specific mobile topbar */
        .ask-anything-mobile #chattermate-mobile-topbar.active {
          display: flex !important;
        }

        .ask-anything-mobile #chattermate-mobile-close.active {
          top: 15px !important;
          right: 15px !important;
          z-index: 1000001 !important;
        }

        /* When topbar is visible, push iframe down to avoid overlap */
        .ask-anything-mobile .chattermate-iframe {
          top: 60px !important;
          height: calc(100vh - 60px) !important;
          height: calc(100dvh - 60px) !important;
        }
      }

      @media (min-width: 769px) {
        #chattermate-mobile-close {
          display: none !important;
        }
      }

      /* Chat Initiation Message Styles */
      #${e.initiationMessageId} {
        position: fixed !important;
        bottom: 95px !important;
        right: 20px !important;
        max-width: 240px !important;
        background: white !important;
        padding: 12px 36px 12px 14px !important;
        border-radius: 14px !important;
        box-shadow: 0 3px 16px rgba(0, 0, 0, 0.1) !important;
        z-index: 999998 !important;
        cursor: pointer !important;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px) scale(0.95);
        transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1) !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        border: none !important;
        display: block !important;
        width: auto !important;
        height: auto !important;
        min-width: 0 !important;
        min-height: 0 !important;
        max-height: none !important;
        line-height: normal !important;
        text-align: left !important;
        vertical-align: baseline !important;
        overflow: visible !important;
      }

      #${e.initiationMessageId}.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
        animation: chattermate-bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      @keyframes chattermate-bounce-in {
        0% {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        50% {
          transform: translateY(-5px) scale(1.02);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      #${e.initiationMessageId}:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.14);
      }

      #${e.initiationMessageId}::after {
        content: '' !important;
        position: absolute !important;
        bottom: -7px !important;
        right: 30px !important;
        width: 14px !important;
        height: 14px !important;
        min-width: 14px !important;
        min-height: 14px !important;
        max-width: 14px !important;
        max-height: 14px !important;
        background: white !important;
        transform: rotate(45deg) !important;
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.06) !important;
        clip-path: polygon(0 0, 100% 0, 100% 100%) !important;
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        z-index: -1 !important;
      }

      .initiation-message-text {
        font-size: 13px !important;
        line-height: 1.4 !important;
        color: #374151 !important;
        margin: 0 !important;
        padding: 0 4px 0 0 !important;
        position: relative !important;
        z-index: 1 !important;
        min-height: 18px !important;
        box-sizing: border-box !important;
        border: none !important;
        background: transparent !important;
        display: block !important;
        width: 100% !important;
        height: auto !important;
        max-width: none !important;
        max-height: none !important;
        text-align: left !important;
        vertical-align: baseline !important;
        font-weight: normal !important;
        font-style: normal !important;
        text-decoration: none !important;
        text-transform: none !important;
        letter-spacing: normal !important;
        word-spacing: normal !important;
        white-space: normal !important;
        overflow-wrap: break-word !important;
        word-wrap: break-word !important;
      }

      .initiation-message-text::after {
        content: '|';
        animation: blink 1s step-end infinite;
        margin-left: 2px;
        color: ${e.chatBubbleColor};
        font-weight: 500;
      }

      .initiation-message-text.typing-complete::after {
        display: none;
      }

      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
      }

      .initiation-close {
        position: absolute !important;
        top: 10px !important;
        right: 10px !important;
        width: 20px !important;
        height: 20px !important;
        min-width: 20px !important;
        min-height: 20px !important;
        max-width: 20px !important;
        max-height: 20px !important;
        background: rgba(0, 0, 0, 0.04) !important;
        border: none !important;
        border-radius: 5px !important;
        cursor: pointer !important;
        opacity: 0.5 !important;
        transition: all 0.2s ease !important;
        z-index: 2 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        outline: none !important;
        box-shadow: none !important;
        text-decoration: none !important;
        font-size: 0 !important;
        line-height: 0 !important;
        overflow: hidden !important;
        flex-shrink: 0 !important;
      }

      .initiation-close:hover {
        opacity: 1 !important;
        background: rgba(0, 0, 0, 0.08) !important;
        transform: scale(1.05) !important;
      }

      .initiation-close::before,
      .initiation-close::after {
        content: '' !important;
        position: absolute !important;
        width: 9px !important;
        height: 1.5px !important;
        min-width: 9px !important;
        min-height: 1.5px !important;
        max-width: 9px !important;
        max-height: 1.5px !important;
        background: #4a5568 !important;
        border-radius: 1px !important;
        top: 50% !important;
        left: 50% !important;
        margin: -0.75px 0 0 -4.5px !important;
        padding: 0 !important;
        border: none !important;
        box-sizing: border-box !important;
      }

      .initiation-close::before {
        transform: rotate(45deg) !important;
      }

      .initiation-close::after {
        transform: rotate(-45deg) !important;
      }

      @media (max-width: 768px) {
        #${e.initiationMessageId} {
          display: none !important;
        }
      }
    `;let i=document.getElementById("chattermate-styles");i&&i.remove(),document.head.appendChild(t)}function b(){return localStorage.getItem(e.tokenKey)}function u(t){t&&localStorage.setItem(e.tokenKey,t)}function I(){localStorage.removeItem(e.tokenKey)}function s(){return window.innerWidth<=768}function l(t){return t?t.replace(/\uFFFD/g,"").replace(/[��]/g,"").replace(/[\x00-\x1F\x7F-\x9F]/g,"").trim():""}function d(){if(!e.chatInitiationMessages||e.chatInitiationMessages.length===0)return null;let t=Math.floor(Math.random()*e.chatInitiationMessages.length),i=e.chatInitiationMessages[t];return i?l(i):null}function L(){return s()||!e.chatInitiationMessages||e.chatInitiationMessages.length===0?!1:!sessionStorage.getItem(e.initiationShownKey)}function x(){sessionStorage.setItem(e.initiationShownKey,"true")}function C(){let t=d();if(!t)return null;let i=document.createElement("div");return i.id=e.initiationMessageId,i.innerHTML=`
      <button class="initiation-close" aria-label="Close"></button>
      <p class="initiation-message-text"></p>
    `,i.dataset.fullMessage=t,i}function $(t,i,n=50){let o=t.querySelector(".initiation-message-text");if(!o)return;let a=0,r=setInterval(()=>{a<i.length?(o.textContent+=i.charAt(a),a++):(clearInterval(r),o.classList.add("typing-complete"),t.typeInterval=null)},n);t.typeInterval=r}function z(t,i){if(!t||!L())return;document.body.appendChild(t),setTimeout(()=>{t.classList.add("show"),setTimeout(()=>{let o=t.dataset.fullMessage;o&&$(t,o,40)},300)},1500),t.addEventListener("click",o=>{o.target.classList.contains("initiation-close")||(t.typeInterval&&clearInterval(t.typeInterval),w(t),i(),x())});let n=t.querySelector(".initiation-close");n&&n.addEventListener("click",o=>{o.stopPropagation(),t.typeInterval&&clearInterval(t.typeInterval),w(t),x()})}function w(t){t&&(t.classList.remove("show"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},400))}function k(){c();let t=document.createElement("div");t.id=e.buttonId,t.innerHTML=`
      <svg class="chat-icon" width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M45 15H15C13.3431 15 12 16.3431 12 18V42C12 43.6569 13.3431 45 15 45H25L30 52L35 45H45C46.6569 45 48 43.6569 48 42V18C48 16.3431 46.6569 15 45 15Z" fill="white"/>
        <path d="M36 27C36 27 32.5 26 30 26C27.5 26 24 27 24 31C24 35 27.5 36 30 36C32.5 36 36 35 36 35V33C36 33 33 34 31.5 34C30 34 27 33 27 31C27 29 30 28 31.5 28C33 28 36 29 36 29V27Z" fill="${e.chatBubbleColor}"/>
      </svg>
      <svg class="close-icon" width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <path d="M20 20L40 40M40 20L20 40" stroke="white" stroke-width="3" stroke-linecap="round"/>
      </svg>
    `;let i=document.createElement("div");i.id=e.containerId;let n=document.createElement("div");n.id="chattermate-mobile-close",n.innerHTML=`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5 12H19" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `;let o=document.createElement("div");o.id="chattermate-mobile-topbar",o.innerHTML=`
      <h3 class="topbar-title">Chat</h3>
      <div style="width: 44px;"></div>
    `,document.body.appendChild(t),document.body.appendChild(i),document.body.appendChild(n),document.body.appendChild(o);let a=!1,r=null,y=!1,h=null;function v(){a=!a,i.classList.toggle("active"),t.classList.toggle("active"),n.classList.toggle("active"),a&&h&&(w(h),h=null,x()),s()?a?(t.classList.remove("mobile-closed"),t.style.animation=""):(t.classList.add("mobile-closed"),t.style.animation="chattermate-bounce 2.2s ease-in-out infinite",o.classList.remove("active"),document.body.classList.remove("ask-anything-mobile")):a&&n.classList.remove("active"),a&&r&&r.contentWindow.postMessage({type:"SCROLL_TO_BOTTOM"},"*")}function S(){return M(this,null,function*(){if(!(y||r))try{y=!0,t.classList.add("loading");let m=b();r=document.createElement("iframe"),r.className="chattermate-iframe";let T=`${e.baseUrl}/widgets/${window.chattermateId}/data?widget_id=${window.chattermateId}`,E=m?{headers:{Authorization:`Bearer ${m}`}}:{};fetch(T,E).then(p=>p.text()).then(p=>{r.srcdoc=p,i.appendChild(r),t.classList.remove("loading"),r.style.opacity="1"}).catch(p=>{console.error("Failed to load widget:",p),t.classList.remove("loading")}),window.addEventListener("message",function(p){p.data.type==="TOKEN_UPDATE"&&(u(p.data.token),r.contentWindow.postMessage({type:"TOKEN_RECEIVED",token:p.data.token},"*"))})}catch(m){console.error("Failed to load widget:",m),t.classList.remove("loading")}finally{y=!1}})}S(),setTimeout(()=>{!a&&e.chatInitiationMessages.length>0&&(h=C(),z(h,v))},2e3),t.addEventListener("click",v),n.addEventListener("click",v),s()&&!a&&(t.classList.add("mobile-closed"),t.style.animation="chattermate-bounce 2.2s ease-in-out infinite"),window.addEventListener("resize",function(){let m=s();m&&!a?(t.classList.add("mobile-closed"),t.style.animation="chattermate-bounce 2.2s ease-in-out infinite",n.classList.remove("active")):m||(t.classList.remove("mobile-closed"),t.style.animation="",a&&n.classList.remove("active")),c()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.addEventListener("message",function(t){if(t.data.type==="CUSTOMIZATION_UPDATE"){let i=t.data.data,n=i.chat_bubble_color;e.chatBubbleColor=g(n)?n:e.chatBubbleColor,i.chat_initiation_messages&&Array.isArray(i.chat_initiation_messages)&&(e.chatInitiationMessages=i.chat_initiation_messages),s()?i.chat_style==="ASK_ANYTHING"&&isOpen?(document.body.classList.add("ask-anything-mobile"),mobileTopbar.classList.add("active")):(document.body.classList.remove("ask-anything-mobile"),mobileTopbar.classList.remove("active")):i.chat_style==="ASK_ANYTHING"?(e.containerBottom=90,e.containerRight=20,e.containerWidth=400):(e.containerBottom=100,e.containerRight=20,e.containerWidth=400),c();let o=document.querySelector(`#${e.buttonId} .chat-icon path:last-child`);o&&o.setAttribute("fill",e.chatBubbleColor)}}),window.ChatterMate={init:function(t){t.baseUrl&&(e.baseUrl=t.baseUrl),window.chattermateId=t.id}}})();})();
