(()=>{var M=(g,u,e)=>new Promise((p,b)=>{var f=l=>{try{r(e.next(l))}catch(m){b(m)}},I=l=>{try{r(e.throw(l))}catch(m){b(m)}},r=l=>l.done?p(l.value):Promise.resolve(l.value).then(f,I);r((e=e.apply(g,u)).next())});window.chattermateId;window.ChatterMate;(function(){function g(t){return/^#[0-9A-F]{6}$/i.test(t)}function u(){return"https://api.chattermate.chat/api/v1"}let e={baseUrl:u(),containerId:"chattermate-container",buttonId:"chattermate-button",chatBubbleColor:"#f34611",loadingContainerId:"chattermate-loading",tokenKey:"ctid",containerBottom:100,containerRight:20,containerWidth:400,chatInitiationMessages:[],initiationMessageId:"chattermate-initiation",initiationShownKey:"ctim_shown"};function p(){let t=document.createElement("style");t.id="chattermate-styles",t.textContent=`
      #${e.buttonId} {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 30px;
        background: ${e.chatBubbleColor};
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 999999;
        transition: transform 0.3s ease;
      }

      #${e.buttonId}:hover {
        transform: scale(1.1);
      }

      #${e.buttonId}.loading {
        position: relative;
      }

      #${e.buttonId}.loading:after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        top: 50%;
        left: 50%;
        margin: -8px 0 0 -8px;
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: chattermate-spin 0.6s linear infinite;
      }

      #${e.buttonId}.active .chat-icon {
        display: none;
      }

      #${e.buttonId}.active .close-icon {
        display: block !important;
      }

      @keyframes chattermate-spin {
        to {transform: rotate(360deg);}
      }

      /* Subtle idle bounce for the chat button when closed */
      @keyframes chattermate-bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-3px); }
      }

      #${e.containerId} {
        position: fixed;
        bottom: ${e.containerBottom||100}px;
        right: ${e.containerRight||20}px;
        width: ${e.containerWidth||400}px;
        height: 600px;
        background: transparent;
        z-index: 999999;
        overflow: hidden;
        /* Animated open/close with slide + fade */
        opacity: 0;
        visibility: hidden;
        transform: translateY(16px) scale(0.98);
        transition: opacity 360ms cubic-bezier(0.22, 1, 0.36, 1), transform 360ms cubic-bezier(0.22, 1, 0.36, 1), visibility 0s linear 360ms;
        border: none;
        padding: 0;
        margin: 0;
        pointer-events: none;
      }

      #${e.containerId}.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
        transition: opacity 420ms cubic-bezier(0.22, 1, 0.36, 1), transform 420ms cubic-bezier(0.22, 1, 0.36, 1);
        pointer-events: auto;
      }

      /* Clean border around the widget container */
      #${e.containerId}::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 24px;
        pointer-events: none;
        border: 1px solid #e5e7eb;
      }

        .chattermate-iframe {
                width: 100%;
        height: 100%;
        border: none;
        padding: 0;
        margin: 0;
        display: block;
        border-radius: 24px;
        /* Rely on corner shadows from container */
        box-shadow: none;
      }

      #chattermate-mobile-close {
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        width: 44px;
        height: 44px;
        background: transparent;
        border: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1000000;
        transition: all 0.3s ease;
      }

      #chattermate-mobile-topbar {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        z-index: 999999;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
      }

      #chattermate-mobile-topbar.active {
        display: flex;
      }

      #chattermate-mobile-topbar .topbar-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin: 0;
      }

      #chattermate-mobile-close.active {
        display: flex;
      }

      @media (max-width: 768px) {
        #${e.containerId} {
          width: 100vw !important;
          height: 100vh !important;
          height: 100dvh !important; /* Dynamic viewport height for mobile browsers */
          top: 0 !important;
          left: 0 !important;
          bottom: 0 !important;
          right: 0 !important;
          border-radius: 0 !important;
          position: fixed !important;
          margin: 0 !important;
          padding: 0 !important;
        }

        #${e.containerId}.active {
          bottom: 0 !important;
        }

        .chattermate-iframe {
          border-radius: 0 !important;
          width: 100vw !important;
          height: 100vh !important;
          height: 100dvh !important; /* Dynamic viewport height for mobile browsers */
          position: absolute !important;
          top: 0 !important;
          left: 0 !important;
          margin: 0 !important;
          padding: 0 !important;
        }

        #${e.buttonId} {
          display: none;
        }

        #${e.buttonId}.mobile-closed {
          display: block !important;
        }

        #chattermate-mobile-close.active {
          display: flex !important;
        }

        #chattermate-mobile-close:hover {
          opacity: 0.7;
        }

        /* ASK_ANYTHING style specific mobile topbar */
        .ask-anything-mobile #chattermate-mobile-topbar.active {
          display: flex !important;
        }

        .ask-anything-mobile #chattermate-mobile-close.active {
          top: 15px !important;
          right: 15px !important;
          z-index: 1000001 !important;
        }

        /* When topbar is visible, push iframe down to avoid overlap */
        .ask-anything-mobile .chattermate-iframe {
          top: 60px !important;
          height: calc(100vh - 60px) !important;
          height: calc(100dvh - 60px) !important;
        }
      }

      @media (min-width: 769px) {
        #chattermate-mobile-close {
          display: none !important;
        }
      }

      /* Chat Initiation Message Styles */
      #${e.initiationMessageId} {
        position: fixed;
        bottom: 95px;
        right: 20px;
        max-width: 240px;
        background: white;
        padding: 12px 36px 12px 14px;
        border-radius: 14px;
        box-shadow: 0 3px 16px rgba(0, 0, 0, 0.1);
        z-index: 999998;
        cursor: pointer;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px) scale(0.95);
        transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      }

      #${e.initiationMessageId}.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
        animation: chattermate-bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      @keyframes chattermate-bounce-in {
        0% {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        50% {
          transform: translateY(-5px) scale(1.02);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      #${e.initiationMessageId}:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.14);
      }

      #${e.initiationMessageId}::after {
        content: '';
        position: absolute;
        bottom: -7px;
        right: 30px;
        width: 14px;
        height: 14px;
        background: white;
        transform: rotate(45deg);
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.06);
        clip-path: polygon(0 0, 100% 0, 100% 100%);
      }

      .initiation-message-text {
        font-size: 13px;
        line-height: 1.4;
        color: #374151;
        margin: 0;
        position: relative;
        z-index: 1;
        padding-right: 4px;
        min-height: 18px;
      }

      .initiation-message-text::after {
        content: '|';
        animation: blink 1s step-end infinite;
        margin-left: 2px;
        color: ${e.chatBubbleColor};
        font-weight: 500;
      }

      .initiation-message-text.typing-complete::after {
        display: none;
      }

      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
      }

      .initiation-close {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 20px;
        height: 20px;
        background: rgba(0, 0, 0, 0.04);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        opacity: 0.5;
        transition: all 0.2s ease;
        z-index: 2;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
      }

      .initiation-close:hover {
        opacity: 1;
        background: rgba(0, 0, 0, 0.08);
        transform: scale(1.05);
      }

      .initiation-close::before,
      .initiation-close::after {
        content: '';
        position: absolute;
        width: 9px;
        height: 1.5px;
        background: #4a5568;
        border-radius: 1px;
      }

      .initiation-close::before {
        transform: rotate(45deg);
      }

      .initiation-close::after {
        transform: rotate(-45deg);
      }

      @media (max-width: 768px) {
        #${e.initiationMessageId} {
          display: none !important;
        }
      }
    `;let i=document.getElementById("chattermate-styles");i&&i.remove(),document.head.appendChild(t)}function b(){return localStorage.getItem(e.tokenKey)}function f(t){t&&localStorage.setItem(e.tokenKey,t)}function I(){localStorage.removeItem(e.tokenKey)}function r(){return window.innerWidth<=768}function l(){if(!e.chatInitiationMessages||e.chatInitiationMessages.length===0)return null;let t=Math.floor(Math.random()*e.chatInitiationMessages.length);return e.chatInitiationMessages[t]}function m(){return r()||!e.chatInitiationMessages||e.chatInitiationMessages.length===0?!1:!sessionStorage.getItem(e.initiationShownKey)}function x(){sessionStorage.setItem(e.initiationShownKey,"true")}function L(){let t=l();if(!t)return null;let i=document.createElement("div");return i.id=e.initiationMessageId,i.innerHTML=`
      <button class="initiation-close" aria-label="Close"></button>
      <p class="initiation-message-text"></p>
    `,i.dataset.fullMessage=t,i}function C(t,i,o=50){let a=t.querySelector(".initiation-message-text");if(!a)return;let n=0,s=setInterval(()=>{n<i.length?(a.textContent+=i.charAt(n),n++):(clearInterval(s),a.classList.add("typing-complete"),t.typeInterval=null)},o);t.typeInterval=s}function $(t,i){if(!t||!m())return;document.body.appendChild(t),setTimeout(()=>{t.classList.add("show"),setTimeout(()=>{let a=t.dataset.fullMessage;a&&C(t,a,40)},300)},1500),t.addEventListener("click",a=>{a.target.classList.contains("initiation-close")||(t.typeInterval&&clearInterval(t.typeInterval),y(t),i(),x())});let o=t.querySelector(".initiation-close");o&&o.addEventListener("click",a=>{a.stopPropagation(),t.typeInterval&&clearInterval(t.typeInterval),y(t),x()})}function y(t){t&&(t.classList.remove("show"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},400))}function k(){p();let t=document.createElement("div");t.id=e.buttonId,t.innerHTML=`
      <svg class="chat-icon" width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M45 15H15C13.3431 15 12 16.3431 12 18V42C12 43.6569 13.3431 45 15 45H25L30 52L35 45H45C46.6569 45 48 43.6569 48 42V18C48 16.3431 46.6569 15 45 15Z" fill="white"/>
        <path d="M36 27C36 27 32.5 26 30 26C27.5 26 24 27 24 31C24 35 27.5 36 30 36C32.5 36 36 35 36 35V33C36 33 33 34 31.5 34C30 34 27 33 27 31C27 29 30 28 31.5 28C33 28 36 29 36 29V27Z" fill="${e.chatBubbleColor}"/>
      </svg>
      <svg class="close-icon" width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <path d="M20 20L40 40M40 20L20 40" stroke="white" stroke-width="3" stroke-linecap="round"/>
      </svg>
    `;let i=document.createElement("div");i.id=e.containerId;let o=document.createElement("div");o.id="chattermate-mobile-close",o.innerHTML=`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5 12H19" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `;let a=document.createElement("div");a.id="chattermate-mobile-topbar",a.innerHTML=`
      <h3 class="topbar-title">Chat</h3>
      <div style="width: 44px;"></div>
    `,document.body.appendChild(t),document.body.appendChild(i),document.body.appendChild(o),document.body.appendChild(a);let n=!1,s=null,w=!1,h=null;function v(){n=!n,i.classList.toggle("active"),t.classList.toggle("active"),o.classList.toggle("active"),n&&h&&(y(h),h=null,x()),r()?n?(t.classList.remove("mobile-closed"),t.style.animation=""):(t.classList.add("mobile-closed"),t.style.animation="chattermate-bounce 2.2s ease-in-out infinite",a.classList.remove("active"),document.body.classList.remove("ask-anything-mobile")):n&&o.classList.remove("active"),n&&s&&s.contentWindow.postMessage({type:"SCROLL_TO_BOTTOM"},"*")}function S(){return M(this,null,function*(){if(!(w||s))try{w=!0,t.classList.add("loading");let d=b();s=document.createElement("iframe"),s.className="chattermate-iframe";let T=`${e.baseUrl}/widgets/${window.chattermateId}/data?widget_id=${window.chattermateId}`,E=d?{headers:{Authorization:`Bearer ${d}`}}:{};fetch(T,E).then(c=>c.text()).then(c=>{s.srcdoc=c,i.appendChild(s),t.classList.remove("loading"),s.style.opacity="1"}).catch(c=>{console.error("Failed to load widget:",c),t.classList.remove("loading")}),window.addEventListener("message",function(c){c.data.type==="TOKEN_UPDATE"&&(f(c.data.token),s.contentWindow.postMessage({type:"TOKEN_RECEIVED",token:c.data.token},"*"))})}catch(d){console.error("Failed to load widget:",d),t.classList.remove("loading")}finally{w=!1}})}S(),setTimeout(()=>{!n&&e.chatInitiationMessages.length>0&&(h=L(),$(h,v))},2e3),t.addEventListener("click",v),o.addEventListener("click",v),r()&&!n&&(t.classList.add("mobile-closed"),t.style.animation="chattermate-bounce 2.2s ease-in-out infinite"),window.addEventListener("resize",function(){let d=r();d&&!n?(t.classList.add("mobile-closed"),t.style.animation="chattermate-bounce 2.2s ease-in-out infinite",o.classList.remove("active")):d||(t.classList.remove("mobile-closed"),t.style.animation="",n&&o.classList.remove("active")),p()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k(),window.addEventListener("message",function(t){if(t.data.type==="CUSTOMIZATION_UPDATE"){let i=t.data.data,o=i.chat_bubble_color;e.chatBubbleColor=g(o)?o:e.chatBubbleColor,i.chat_initiation_messages&&Array.isArray(i.chat_initiation_messages)&&(e.chatInitiationMessages=i.chat_initiation_messages),r()?i.chat_style==="ASK_ANYTHING"&&isOpen?(document.body.classList.add("ask-anything-mobile"),mobileTopbar.classList.add("active")):(document.body.classList.remove("ask-anything-mobile"),mobileTopbar.classList.remove("active")):i.chat_style==="ASK_ANYTHING"?(e.containerBottom=90,e.containerRight=20,e.containerWidth=400):(e.containerBottom=100,e.containerRight=20,e.containerWidth=400),p();let a=document.querySelector(`#${e.buttonId} .chat-icon path:last-child`);a&&a.setAttribute("fill",e.chatBubbleColor)}}),window.ChatterMate={init:function(t){t.baseUrl&&(e.baseUrl=t.baseUrl),window.chattermateId=t.id}}})();})();
